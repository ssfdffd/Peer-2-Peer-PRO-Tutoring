<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Forum | Grade-Based Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* Base Styles & Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #1e293b;
            transition: background-color 0.3s ease;
        }

        /* Color Variables */
        :root {
            --primary-blue: #38bdf8;
            --secondary-blue: #0ea5e9;
            --accent-green: #10b981;
            --light-green: #d1fae5;
            --text-dark: #1e293b;
            --text-medium: #64748b;
            --text-light: #94a3b8;
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --box-shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        /* Navigation */
        .glass-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 40px;
            background: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo-glow {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-glow .premium {
            color: var(--accent-green);
            background: linear-gradient(90deg, var(--accent-green), #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-hub {
            position: relative;
            cursor: pointer;
        }

        #bellIcon {
            font-size: 1.3rem;
            color: var(--text-medium);
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 50%;
        }

        #bellIcon:hover {
            color: var(--primary-blue);
            background-color: var(--gray-100);
        }

        .badge-red {
            position: absolute;
            top: -2px;
            right: -2px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notif-box {
            position: absolute;
            top: 45px;
            right: 0;
            width: 300px;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-hover);
            border: 1px solid var(--gray-200);
            padding: 15px;
            z-index: 10;
        }

        .logout-minimal {
            background: var(--gray-100);
            color: var(--text-medium);
            border: none;
            padding: 10px 18px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .logout-minimal:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-1px);
        }

        /* Dashboard Layout */
        .dashboard-wrapper {
            display: flex;
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            gap: 30px;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar */
        .side-panel {
            width: 320px;
            flex-shrink: 0;
        }

        .ask-box-sidebar {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-200);
            position: sticky;
            top: 100px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 20px;
        }

        .ask-box-sidebar:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-hover);
        }

        .ask-box-sidebar h4 {
            font-size: 1.2rem;
            color: var(--text-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ask-box-sidebar h4 i {
            color: var(--accent-green);
        }

        /* Grade Selection */
        .grade-selection {
            margin-bottom: 20px;
        }

        .grade-selection label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .grade-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .grade-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-300);
            background: var(--white);
            color: var(--text-medium);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .grade-btn:hover {
            background: var(--gray-100);
            border-color: var(--primary-blue);
        }

        .grade-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .grade-btn.grade-11 {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-green));
            color: white;
            border: none;
            font-weight: 600;
        }

        #forumQuestion {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            resize: vertical;
            font-size: 0.95rem;
            transition: border-color 0.2s ease;
        }

        #forumQuestion:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .btn-ask {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-green));
            color: white;
            border: none;
            width: 100%;
            padding: 14px;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-ask:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(56, 189, 248, 0.3);
        }

        .btn-ask:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Filter Panel */
        .filter-panel {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-200);
            position: sticky;
            top: 100px;
        }

        .filter-panel h4 {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-panel h4 i {
            color: var(--accent-green);
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--gray-300);
            background: var(--white);
            color: var(--text-medium);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            flex: 1;
            min-width: calc(50% - 8px);
            text-align: center;
        }

        .filter-btn:hover {
            background: var(--gray-100);
            border-color: var(--primary-blue);
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .filter-btn.all-grades {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-green));
            color: white;
            border: none;
            font-weight: 600;
            min-width: 100%;
        }

        /* Main Panel */
        .main-panel {
            flex: 1;
        }

        .portal-section {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-200);
            overflow: hidden;
        }

        .section-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--gray-200);
            background: linear-gradient(to right, #f0f9ff, #f0fdf4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h3 {
            font-size: 1.5rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-header i {
            color: var(--accent-green);
        }

        .current-grade-badge {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-green));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Forum Cards */
        #forumFeed {
            padding: 20px;
        }

        .forum-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--gray-200);
            box-shadow: var(--box-shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .forum-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
            border-color: var(--gray-300);
        }

        .forum-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-blue), var(--accent-green));
            border-radius: var(--border-radius) 0 0 var(--border-radius);
        }

        .forum-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .forum-user {
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .forum-user i {
            color: var(--accent-green);
            font-size: 1.2rem;
        }

        .grade-badge {
            background: var(--gray-100);
            color: var(--text-medium);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        .grade-badge.grade-11 {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-green));
            color: white;
        }

        .forum-date {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .forum-text {
            line-height: 1.7;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-left: 5px;
        }

        .forum-actions {
            border-top: 1px solid var(--gray-100);
            padding-top: 20px;
            display: flex;
            gap: 25px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-medium);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .action-btn:hover {
            color: var(--accent-green);
            background-color: var(--gray-100);
        }

        .action-btn i {
            font-size: 0.9rem;
        }

        /* Delete Button */
        .delete-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--gray-300);
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.05);
        }

        /* Replies Section */
        .replies-dropdown {
            background: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 15px;
            border-left: 4px solid var(--accent-green);
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reply-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .reply-item:last-child {
            border-bottom: none;
        }

        .reply-item strong {
            color: var(--text-dark);
            min-width: 80px;
        }

        .del-small {
            font-size: 0.75rem;
            color: #ef4444;
            cursor: pointer;
            margin-left: auto;
            text-decoration: underline;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .del-small:hover {
            opacity: 1;
        }

        /* Reply Input Box */
        .reply-input-box {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            background: var(--gray-100);
            padding: 15px;
            border-radius: var(--border-radius);
            animation: slideDown 0.3s ease-out;
        }

        .black-typing {
            flex: 1;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-300);
            color: var(--text-dark) !important;
            background: var(--white) !important;
            font-size: 0.95rem;
            transition: border-color 0.2s ease;
        }

        .black-typing:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Loading States */
        .loading-state,
        .loading-small {
            text-align: center;
            padding: 30px;
            color: var(--text-medium);
            font-style: italic;
        }

        .text-dim {
            color: var(--text-light);
            text-align: center;
            padding: 30px;
            font-style: italic;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--gray-300);
            margin-bottom: 20px;
        }

        .empty-state h4 {
            color: var(--text-medium);
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--text-light);
            max-width: 400px;
            margin: 0 auto;
        }

        .empty-state .btn-ask {
            width: auto;
            margin-top: 20px;
            display: inline-flex;
            padding: 12px 24px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-wrapper {
                flex-direction: column;
            }

            .side-panel {
                width: 100%;
            }

            .ask-box-sidebar,
            .filter-panel {
                position: static;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 768px) {
            .glass-nav {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .nav-right {
                width: 100%;
                justify-content: space-between;
            }

            .dashboard-wrapper {
                margin: 20px auto;
                padding: 0 15px;
                gap: 20px;
            }

            .forum-actions {
                flex-wrap: wrap;
                gap: 15px;
            }

            .reply-input-box {
                flex-direction: column;
            }

            .grade-buttons {
                justify-content: center;
            }

            .grade-btn {
                flex: 1;
                min-width: calc(25% - 8px);
                text-align: center;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-light);
        }
    </style>
</head>

<body class="light-mode">

    <nav class="glass-nav">
        <div class="logo-glow">
            <i class="fas fa-graduation-cap"></i>
            P2P <span class="premium">GRADE FORUM</span>
        </div>
        <div class="nav-right">
            <div class="current-grade-badge" id="currentGradeBadge">
                <i class="fas fa-user-graduate"></i>
                Grade <span id="currentGradeDisplay">11</span>
            </div>
            <div class="notification-hub">
                <i class="fas fa-bell" id="bellIcon" onclick="toggleNotifs()"></i>
                <span id="notifBadge" class="badge-red" style="display:none;">0</span>
                <div id="notifDropdown" class="notif-box" style="display:none;">
                    <p style="text-align: center; color: var(--text-medium);">No new notifications</p>
                </div>
            </div>
            <button class="logout-minimal" onclick="location.href='student-portal.html'">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
        </div>
    </nav>

    <div class="dashboard-wrapper">
        <aside class="side-panel">
            <div class="ask-box-sidebar">
                <h4><i class="fas fa-pen-nib"></i> Start a Discussion</h4>

                <div class="grade-selection">
                    <label><i class="fas fa-filter"></i> Select Grade for this Question</label>
                    <div class="grade-buttons" id="gradeButtons">
                        <!-- Grade buttons 1-12 will be generated here -->
                    </div>
                </div>

                <textarea id="forumQuestion"
                    placeholder="What subject are you struggling with? Ask your grade-specific question here..."></textarea>
                <button class="btn-ask" onclick="submitToForum()" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> Post to Grade Forum
                </button>
            </div>

            <div class="filter-panel">
                <h4><i class="fas fa-sliders-h"></i> Filter Discussions</h4>
                <div class="filter-buttons" id="filterButtons">
                    <!-- Filter buttons will be generated here -->
                </div>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 15px; line-height: 1.5;">
                    <i class="fas fa-info-circle"></i> View questions from all grades or filter by specific grade
                    levels.
                </p>
            </div>
        </aside>

        <main class="main-panel">
            <section class="portal-section">
                <div class="section-header">
                    <h3><i class="fas fa-comments"></i> Grade-Based Discussions</h3>
                    <div class="current-grade-badge">
                        <i class="fas fa-eye"></i>
                        Viewing: <span id="viewingFilter">Grade 11 Only</span>
                    </div>
                </div>
                <div id="forumFeed">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i> Loading discussions...
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Sample data with grade information
        const sampleQuestions = [
            {
                id: 1,
                userName: "Alex Johnson",
                grade: 11,
                date: "2 hours ago",
                text: "Can someone explain how to solve quadratic equations using the quadratic formula? I'm stuck on my math homework.",
                replies: [
                    { id: 101, userName: "Sam Rivera", replyText: "Sure! Remember the formula is x = [-b ± √(b² - 4ac)] / 2a. Start by identifying a, b, and c from your equation." },
                    { id: 102, userName: "Taylor Kim", replyText: "I found this Khan Academy video really helpful for visualizing it!" }
                ]
            },
            {
                id: 2,
                userName: "Maria Chen",
                grade: 11,
                date: "Yesterday, 3:42 PM",
                text: "Studying for chemistry final - any tips for memorizing the periodic table trends?",
                replies: [
                    { id: 201, userName: "Jordan Lee", replyText: "Create flashcards with mnemonics! That's what worked for me." }
                ]
            },
            {
                id: 3,
                userName: "David Park",
                grade: 12,
                date: "Nov 12, 10:15 AM",
                text: "AP Calculus question: How do I find the derivative of implicit functions?",
                replies: []
            },
            {
                id: 4,
                userName: "Sophia Williams",
                grade: 9,
                date: "Nov 10, 2:30 PM",
                text: "Need help with basic algebra - solving for x in equations like 2x + 5 = 15",
                replies: [
                    { id: 401, userName: "Mr. Thompson (Teacher)", replyText: "Great question! Start by subtracting 5 from both sides, then divide by 2." }
                ]
            },
            {
                id: 5,
                userName: "James Wilson",
                grade: 7,
                date: "Nov 9, 4:20 PM",
                text: "What's the difference between a metaphor and a simile? English test tomorrow!",
                replies: [
                    { id: 501, userName: "Emma Garcia", replyText: "Simile uses 'like' or 'as' (quiet as a mouse), metaphor doesn't (he's a lion)." }
                ]
            },
            {
                id: 6,
                userName: "Olivia Brown",
                grade: 11,
                date: "Nov 8, 11:15 AM",
                text: "Physics question: How do I calculate acceleration when given velocity and time?",
                replies: [
                    { id: 601, userName: "Noah Martinez", replyText: "Use a = Δv/Δt (change in velocity divided by change in time)." },
                    { id: 602, userName: "Alex Johnson", replyText: "Make sure your units are consistent! Convert to m/s and seconds if needed." }
                ]
            }
        ];

        // Current user for demo (Grade 11 student)
        const currentUser = {
            name: "Alex Johnson",
            grade: 11
        };

        // State
        let selectedGrade = currentUser.grade;
        let currentFilter = 'grade-11'; // Default filter
        let allGrades = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize grade selection buttons (1-12)
            initializeGradeButtons();

            // Initialize filter buttons
            initializeFilterButtons();

            // Set current user in localStorage for demo
            localStorage.setItem('userName', currentUser.name);
            localStorage.setItem('userGrade', currentUser.grade);
            localStorage.setItem('school_id', 'demo-school-123');

            // Update UI to show current grade
            document.getElementById('currentGradeDisplay').textContent = currentUser.grade;

            // Load and display questions
            filterQuestions(currentFilter);

            // Check notifications every 20 seconds
            setInterval(checkNotifications, 20000);
        });

        function initializeGradeButtons() {
            const container = document.getElementById('gradeButtons');
            container.innerHTML = '';

            allGrades.forEach(grade => {
                const button = document.createElement('button');
                button.className = `grade-btn ${grade === currentUser.grade ? 'grade-11 active' : ''}`;
                button.textContent = `Grade ${grade}`;
                button.dataset.grade = grade;
                button.onclick = () => selectGrade(grade);

                // Highlight user's current grade
                if (grade === currentUser.grade) {
                    button.innerHTML = `<i class="fas fa-user-graduate"></i> Grade ${grade}`;
                }

                container.appendChild(button);
            });
        }

        function initializeFilterButtons() {
            const container = document.getElementById('filterButtons');
            container.innerHTML = '';

            // "All Grades" button
            const allButton = document.createElement('button');
            allButton.className = 'filter-btn all-grades active';
            allButton.innerHTML = `<i class="fas fa-layer-group"></i> All Grades`;
            allButton.dataset.filter = 'all';
            allButton.onclick = () => applyFilter('all');
            container.appendChild(allButton);

            // "My Grade" button
            const myGradeButton = document.createElement('button');
            myGradeButton.className = 'filter-btn';
            myGradeButton.innerHTML = `<i class="fas fa-user-graduate"></i> My Grade (${currentUser.grade})`;
            myGradeButton.dataset.filter = `grade-${currentUser.grade}`;
            myGradeButton.onclick = () => applyFilter(`grade-${currentUser.grade}`);
            container.appendChild(myGradeButton);

            // Grade range buttons
            const gradeRanges = [
                { label: 'Elementary (1-5)', filter: 'elementary', grades: [1, 2, 3, 4, 5] },
                { label: 'Middle (6-8)', filter: 'middle', grades: [6, 7, 8] },
                { label: 'High School (9-12)', filter: 'highschool', grades: [9, 10, 11, 12] }
            ];

            gradeRanges.forEach(range => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = range.label;
                button.dataset.filter = range.filter;
                button.dataset.grades = JSON.stringify(range.grades);
                button.onclick = () => applyFilter(range.filter);
                container.appendChild(button);
            });
        }

        function selectGrade(grade) {
            selectedGrade = grade;

            // Update button states
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.classList.remove('active', 'grade-11');
                if (parseInt(btn.dataset.grade) === grade) {
                    btn.classList.add('active');
                    if (grade === currentUser.grade) {
                        btn.classList.add('grade-11');
                    }
                }
            });

            // Update button text for selected grade
            const selectedBtn = document.querySelector(`.grade-btn[data-grade="${grade}"]`);
            if (grade === currentUser.grade) {
                selectedBtn.innerHTML = `<i class="fas fa-user-graduate"></i> Grade ${grade}`;
            } else {
                selectedBtn.innerHTML = `Grade ${grade}`;
            }

            // Enable/disable submit button
            const submitBtn = document.getElementById('submitBtn');
            if (!selectedGrade) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = `<i class="fas fa-exclamation-circle"></i> Select a Grade First`;
            } else {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<i class="fas fa-paper-plane"></i> Post to Grade ${selectedGrade}`;
            }
        }

        function applyFilter(filter) {
            currentFilter = filter;

            // Update filter button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });

            // Update viewing filter display
            const viewingText = document.getElementById('viewingFilter');
            switch (filter) {
                case 'all':
                    viewingText.textContent = 'All Grades';
                    break;
                case `grade-${currentUser.grade}`:
                    viewingText.textContent = `Grade ${currentUser.grade} Only`;
                    break;
                case 'elementary':
                    viewingText.textContent = 'Elementary (Grades 1-5)';
                    break;
                case 'middle':
                    viewingText.textContent = 'Middle School (Grades 6-8)';
                    break;
                case 'highschool':
                    viewingText.textContent = 'High School (Grades 9-12)';
                    break;
                default:
                    if (filter.startsWith('grade-')) {
                        const grade = filter.replace('grade-', '');
                        viewingText.textContent = `Grade ${grade} Only`;
                    }
            }

            // Apply the filter
            filterQuestions(filter);
        }

        function filterQuestions(filter) {
            let filteredQuestions = [];

            switch (filter) {
                case 'all':
                    filteredQuestions = [...sampleQuestions];
                    break;

                case `grade-${currentUser.grade}`:
                    filteredQuestions = sampleQuestions.filter(q => q.grade === currentUser.grade);
                    break;

                case 'elementary':
                    filteredQuestions = sampleQuestions.filter(q => q.grade >= 1 && q.grade <= 5);
                    break;

                case 'middle':
                    filteredQuestions = sampleQuestions.filter(q => q.grade >= 6 && q.grade <= 8);
                    break;

                case 'highschool':
                    filteredQuestions = sampleQuestions.filter(q => q.grade >= 9 && q.grade <= 12);
                    break;

                default:
                    if (filter.startsWith('grade-')) {
                        const grade = parseInt(filter.replace('grade-', ''));
                        filteredQuestions = sampleQuestions.filter(q => q.grade === grade);
                    } else {
                        filteredQuestions = [...sampleQuestions];
                    }
            }

            renderForum(filteredQuestions);
        }

        function renderForum(questions) {
            const feed = document.getElementById('forumFeed');

            if (!questions || questions.length === 0) {
                feed.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment-slash"></i>
                        <h4>No discussions found</h4>
                        <p>No questions match your current filter. Try changing the filter or be the first to ask a question!</p>
                        <button class="btn-ask" onclick="scrollToAskBox()">
                            <i class="fas fa-plus"></i> Ask First Question
                        </button>
                    </div>
                `;
                return;
            }

            feed.innerHTML = '';

            questions.forEach(q => {
                const isOwner = q.userName === currentUser.name;
                const isUserGrade = q.grade === currentUser.grade;
                const card = document.createElement('div');
                card.className = 'forum-card';
                card.innerHTML = `
                    ${isOwner ? `<button class="delete-btn" onclick="deleteQuestion(${q.id})" title="Delete discussion"><i class="fas fa-trash"></i></button>` : ''}
                    
                    <div class="forum-header">
                        <div class="forum-user">
                            <i class="fas fa-user-circle"></i> ${q.userName}
                            <span class="grade-badge ${isUserGrade ? 'grade-11' : ''}">
                                <i class="fas fa-graduation-cap"></i> Grade ${q.grade}
                            </span>
                        </div>
                    </div>
                    
                    <div class="forum-date"><i class="far fa-clock"></i> ${q.date}</div>
                    <div class="forum-text">${q.text}</div>
                    
                    <div class="forum-actions">
                        <button class="action-btn" onclick="toggleReplies(${q.id})" id="toggle-btn-${q.id}">
                            <i class="fas fa-chevron-down"></i> 
                            <span>View Answers (${q.replies.length})</span>
                        </button>
                        <button class="action-btn" onclick="toggleHelpInput(${q.id})">
                            <i class="fas fa-hands-helping"></i> Help Peer
                        </button>
                        ${!isUserGrade ? `<button class="action-btn" onclick="switchToGrade(${q.grade})" title="View more Grade ${q.grade} questions">
                            <i class="fas fa-exchange-alt"></i> Switch to Grade ${q.grade}
                        </button>` : ''}
                    </div>

                    <div id="help-input-${q.id}" class="reply-input-box" style="display:none;">
                        <input type="text" id="input-text-${q.id}" placeholder="Write your answer here..." class="black-typing">
                        <button class="btn-ask" onclick="submitReply(${q.id})" style="padding: 12px 20px;">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>

                    <div id="replies-list-${q.id}" class="replies-dropdown" style="display:none;">
                        ${q.replies.length ?
                        q.replies.map(r => `
                                <div class="reply-item">
                                    <strong>${r.userName}:</strong> 
                                    <span>${r.replyText}</span>
                                    ${r.userName === currentUser.name ? `<span class="del-small" onclick="deleteReply(${r.id}, ${q.id})">Delete</span>` : ''}
                                </div>
                            `).join('')
                        : '<div class="reply-item text-dim">No answers yet. Be the first to help!</div>'
                    }
                    </div>
                `;
                feed.appendChild(card);
            });
        }

        function switchToGrade(grade) {
            // Update grade selection
            selectGrade(grade);

            // Apply filter for this grade
            applyFilter(`grade-${grade}`);

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            showNotification(`Now viewing Grade ${grade} questions`);
        }

        function scrollToAskBox() {
            document.getElementById('forumQuestion').focus();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleHelpInput(id) {
            const el = document.getElementById(`help-input-${id}`);
            const isVisible = el.style.display === 'flex';

            // Close all other open inputs
            document.querySelectorAll('.reply-input-box').forEach(box => {
                if (box.id !== `help-input-${id}`) {
                    box.style.display = 'none';
                }
            });

            el.style.display = isVisible ? 'none' : 'flex';

            // Focus the input when shown
            if (!isVisible) {
                setTimeout(() => {
                    document.getElementById(`input-text-${id}`).focus();
                }, 100);
            }
        }

        function toggleReplies(id) {
            const list = document.getElementById(`replies-list-${id}`);
            const toggleBtn = document.getElementById(`toggle-btn-${id}`);
            const icon = toggleBtn.querySelector('i');

            if (list.style.display === 'none' || list.style.display === '') {
                list.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
                toggleBtn.querySelector('span').textContent = `Hide Answers`;
            } else {
                list.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
                const question = sampleQuestions.find(q => q.id === id);
                toggleBtn.querySelector('span').textContent = `View Answers (${question?.replies.length || 0})`;
            }
        }

        function submitToForum() {
            const textInput = document.getElementById('forumQuestion');
            const text = textInput.value.trim();

            if (!selectedGrade) {
                alert("Please select a grade for your question!");
                return;
            }

            if (!text) {
                alert("Please write your question before posting!");
                textInput.focus();
                return;
            }

            // In a real app, you would send this to your API
            // For demo, we'll simulate adding a new question
            const newQuestion = {
                id: sampleQuestions.length + 1,
                userName: currentUser.name,
                grade: selectedGrade,
                date: "Just now",
                text: text,
                replies: []
            };

            sampleQuestions.unshift(newQuestion); // Add to beginning

            // Re-apply current filter to refresh view
            filterQuestions(currentFilter);

            // Reset form
            textInput.value = '';
            textInput.placeholder = "Question posted to Grade " + selectedGrade + "! Ask another?";

            // Reset placeholder after 3 seconds
            setTimeout(() => {
                textInput.placeholder = "What subject are you struggling with? Ask your grade-specific question here...";
            }, 3000);

            // Reset grade selection to user's grade
            selectGrade(currentUser.grade);

            // Show notification
            showNotification(`Question posted to Grade ${selectedGrade} forum!`);
        }

        function submitReply(questionId) {
            const textInput = document.getElementById(`input-text-${questionId}`);
            const replyText = textInput.value.trim();

            if (!replyText) {
                alert("Please write a reply before sending!");
                return;
            }

            // Find the question and add reply
            const question = sampleQuestions.find(q => q.id === questionId);
            if (question) {
                const newReply = {
                    id: question.replies.length + 100,
                    userName: currentUser.name,
                    replyText: replyText
                };
                question.replies.push(newReply);

                // Update the UI
                const list = document.getElementById(`replies-list-${questionId}`);
                if (list.style.display !== 'none') {
                    const replyItem = document.createElement('div');
                    replyItem.className = 'reply-item';
                    replyItem.innerHTML = `
                        <strong>${newReply.userName}:</strong> 
                        <span>${newReply.replyText}</span>
                        <span class="del-small" onclick="deleteReply(${newReply.id}, ${questionId})">Delete</span>
                    `;
                    list.appendChild(replyItem);

                    // If this was the first reply, remove the "no answers" message
                    const noAnswersMsg = list.querySelector('.text-dim');
                    if (noAnswersMsg) {
                        noAnswersMsg.remove();
                    }
                }

                // Update the toggle button text
                const toggleBtn = document.getElementById(`toggle-btn-${questionId}`);
                toggleBtn.querySelector('span').textContent = `View Answers (${question.replies.length})`;
            }

            // Clear and hide the input
            textInput.value = '';
            document.getElementById(`help-input-${questionId}`).style.display = 'none';

            // Show notification
            showNotification("Your answer has been posted!");
        }

        function deleteQuestion(id) {
            if (!confirm("Are you sure you want to delete this discussion? This action cannot be undone.")) {
                return;
            }

            // Find index and remove
            const index = sampleQuestions.findIndex(q => q.id === id);
            if (index !== -1) {
                sampleQuestions.splice(index, 1);
                filterQuestions(currentFilter); // Refresh with current filter
                showNotification("Discussion deleted successfully.");
            }
        }

        function deleteReply(replyId, questionId) {
            if (!confirm("Delete this answer?")) {
                return;
            }

            // Find the question and remove the reply
            const question = sampleQuestions.find(q => q.id === questionId);
            if (question) {
                const replyIndex = question.replies.findIndex(r => r.id === replyId);
                if (replyIndex !== -1) {
                    question.replies.splice(replyIndex, 1);

                    // Update the UI
                    const list = document.getElementById(`replies-list-${questionId}`);
                    if (list.style.display !== 'none') {
                        // Hide and show again to refresh
                        list.style.display = 'none';
                        setTimeout(() => {
                            list.style.display = 'block';
                            // Re-populate replies
                            list.innerHTML = question.replies.length ?
                                question.replies.map(r => `
                                    <div class="reply-item">
                                        <strong>${r.userName}:</strong> 
                                        <span>${r.replyText}</span>
                                        ${r.userName === currentUser.name ? `<span class="del-small" onclick="deleteReply(${r.id}, ${questionId})">Delete</span>` : ''}
                                    </div>
                                `).join('')
                                : '<div class="reply-item text-dim">No answers yet. Be the first to help!</div>';
                        }, 10);
                    }

                    // Update the toggle button text
                    const toggleBtn = document.getElementById(`toggle-btn-${questionId}`);
                    toggleBtn.querySelector('span').textContent = `View Answers (${question.replies.length})`;

                    showNotification("Answer deleted.");
                }
            }
        }

        function toggleNotifs() {
            const dropdown = document.getElementById('notifDropdown');
            const bell = document.getElementById('bellIcon');

            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
                bell.style.color = 'var(--primary-blue)';
            } else {
                dropdown.style.display = 'none';
                bell.style.color = '';
            }
        }

        function checkNotifications() {
            // In a real app, you would fetch from your API
            // For demo, we'll simulate occasional notifications
            if (Math.random() > 0.7) {
                const badge = document.getElementById('notifBadge');
                const count = parseInt(badge.textContent) || 0;
                badge.textContent = count + 1;
                badge.style.display = 'block';

                // Add to dropdown
                const dropdown = document.getElementById('notifDropdown');
                const newNotif = document.createElement('div');
                newNotif.className = 'reply-item';
                const grades = ['Grade 9', 'Grade 10', 'Grade 11', 'Grade 12'];
                const randomGrade = grades[Math.floor(Math.random() * grades.length)];
                newNotif.innerHTML = `<strong>New:</strong> Someone replied to your ${randomGrade} question!`;
                dropdown.insertBefore(newNotif, dropdown.firstChild);
            }
        }

        function showNotification(message) {
            // Create a temporary notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: var(--accent-green);
                color: white;
                padding: 15px 25px;
                border-radius: var(--border-radius);
                box-shadow: var(--box-shadow-hover);
                z-index: 1000;
                animation: slideInRight 0.3s ease-out;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 350px;
            `;

            notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);

            // Add keyframe for animation
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    </script>
</body>

</html>